<!DOCTYPE html>
<html>
<head th:replace="fragments/header :: header (datatables = true, checkbox = true)" />
<body class="top-navigation">
	<div id="wrapper">
		<div id="page-wrapper" class="gray-bg">
			<div th:replace="fragments/topbar :: topbar (page = 'otherUsers.change-password-list')" />

			<div class="wrapper wrapper-content">
				<div class="row">
					<div class="col-lg-9">
						<div class="ibox">
							<div class="ibox-title">
								<h5><em class="fa fa-users"></em> &nbsp; Brugere</h5>
							</div>

							<div class="ibox-content">
								<p>
									Nedenfor listes alle de brugere som du kan skifte kodeord på. Bemærk at listen kun indeholder
									brugere der ikke må få en erhvervsidentitet. Brugere der er tildelt muligheden for at få en
									erhvervsidentitet er underlagt andre sikkerhedsregler, og kan ikke administreres her.
								</p>
								<p>
									Man kan anvende søgefelter over hver kolonne for at filtrere listen af brugere, samt
									klikke på den enkelte overskrift for at sortere efter den valgte kolonne.
								</p>
								
								<h4>Brugere</h4>
								<div class="table-responsive">
									<table id="persons" class="table table-striped table-bordered table-hover" >
										<thead>
											<tr>
												<th>Person</th>
												<th style="width: 200px;">Brugernavn</th>
												<th style="width: 200px;">Domæne</th>
												<th style="width: 80px;">Handling</th>
											</tr>
										</thead>
										
										<tfoot style="display: table-row-group">
											<tr>
												<td class="input-filter"><input type="text" class="form-control input-sm" style="width: 100%;" placeholder="Søg" /></td>
												<td class="input-filter"><input type="text" class="form-control input-sm" style="width: 100%;" placeholder="Søg" /></td>
												<td class="input-filter"><input type="text" class="form-control input-sm" style="width: 100%;" placeholder="Søg" /></td>
												<td></td>
											</tr>
										</tfoot>

										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					
					<div th:replace="fragments/rightbar :: otherUsers (page = 'otherUsers.change-password-list')" />
				</div>
			</div>

			<div th:replace="fragments/footer :: footer" />
		</div>
	</div>

	<div th:replace="fragments/footer :: scripts (datatables = true, checkbox = true)" />

	<script th:inline="javascript">
		/*<![CDATA[*/

		/*[+
		var baseUrl = [[@{/}]];
		var flashSuccess = [[${flashSuccess}]];
		var flashWarning = [[${flashWarning}]];
		var flashError = [[${flashError}]];
		+]*/

		var token = $("meta[name='_csrf']").attr("content");

		var changePasswordListService;
		$(document).ready(function(){
			changePasswordListService = new ChangePasswordListService();
			changePasswordListService.initializeDatatable();

			if (flashSuccess != undefined) {
				toastr.success(flashSuccess);
			}
			if (flashWarning != undefined) {
				toastr.warning(flashWarning);
			}
			if (flashError != undefined) {
				toastr.error(flashError);
			}
		});

		function ChangePasswordListService() {

			this.initializeDatatable = function() {
				table = $('#persons').DataTable({
					"destroy": true,
					"ajax": {
						"contentType": "application/json",
						"url": baseUrl + "rest/change-password/persons",
						"type": 'POST',
						"headers": {
							'X-CSRF-TOKEN': token
						},
						"data": function(d) {
						 	return JSON.stringify(d);
						}
					},
					"serverSide" : true,
					"columns": [
						{
							"data": "name",
							"orderable": false
						},
						{
							"data": "userId",
							"orderable": false
						},
						{
							"data": "domainName",
							"orderable": false
						},
						{
							"data": "id",
							"searchable": false,
							"orderable": false,
							"render": function (data, type, row, meta) {
								var content = '<a href="' + baseUrl + 'andre-brugere/' + data + '/kodeord/skift/" style="color: black;" title="Skift kodeord"><em class="fa fa-fw fa-key"></em></a>';

								return content;
							}
						}
					],
					"ordering": true,
					"info": true,
					"pageLength": 10,
					"lengthChange": false,
					"bSort": false,
					"dom": "<'row'<'col-sm-12'tr>><'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
					"responsive": true,
					"language": {
						"search":	   "Søg",
						"lengthMenu":   "_MENU_ rækker per side",
						"info":		 "Viser _START_ til _END_ af _TOTAL_ brugere",
						"zeroRecords":  "Ingen data...",
						"infoEmpty":	"Henter data...",
						"infoFiltered": "(ud af _MAX_ brugere)",
						"paginate": {
							"previous": "Forrige",
							"next": "Næste"
						}
					}
				});

				$.each($('.input-filter', table.table().footer()), function() {
					var column = table.column($(this).index());
		
					$('input', this).on('keyup change', function () {
						if (column.search() !== this.value) {
							column.search(this.value).draw();
						}
					});
				});
			}
		}
		/*]]>*/
	</script>
</body>
</html>
